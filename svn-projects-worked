#!/opt/scala-2.9.2/bin/scala
exec scala "$0" "$@"
!#

import scala.sys.process._

if (args.size == 0) {
  println("Usage: git-projects-worked author [since] [until]")
  System.exit(1)
}

val author = args(0)

// extract from args array or return default if not present
def extract(idx: Int, default: String) = 
  if (args.length < idx + 1) default
  else args(idx)

val since = extract(1, "2001-01-01")
val until = extract(2, "3000-01-01")


val cmd = "svn log -v -r {" + since + "}:{" + until + "} --xml"

println("Running " + cmd)
println

val xml = scala.xml.XML.loadString(cmd!!)  // stream?


println("Projects worked on")
println("------------------")
(xml \ "logentry")
.filter { e => (e \ "author").text.trim == author }
.map { e => (e \ "paths" \ "path").text.trim }
.map { _.split("/src/") }
.filter { _.size == 2 }
.groupBy { _(0) }
.keySet
.foreach { println }
